<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriCourt ‚Äì Digital Evidence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { scroll-behavior: smooth; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        .fade-in { animation: fadeIn 0.7s ease-out; }
        .slide-right { animation: slideRight 0.6s ease-out; }
        
        /* Dark Theme (Default) */
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e7ff;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        /* Light Theme */
        body.light-mode {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            color: #1e293b;
        }
        .glass-dark {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        body.light-mode .glass-dark {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4);
        }
        .input-field {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #e0e7ff;
            padding: 12px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        body.light-mode .input-field {
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #1e293b;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        body.light-mode .input-field:focus {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .input-field::placeholder { color: #64748b; }
        
        body.light-mode .input-field::placeholder { color: #94a3b8; }
        .drop-zone {
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.3);
        }
        
        body.light-mode .drop-zone {
            background: rgba(248, 250, 252, 0.5);
            border: 2px dashed rgba(59, 130, 246, 0.4);
        }
        
        .drop-zone:hover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .drop-zone.drag-over { border-color: #3b82f6; background: rgba(59, 130, 246, 0.15); transform: scale(1.02); }
        
        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }
        
        body.light-mode .theme-toggle {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }
        
        body.light-mode .theme-toggle:hover {
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.6);
        }
        .badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-success { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-warning { background: rgba(251, 146, 60, 0.2); color: #fed7aa; border: 1px solid rgba(251, 146, 60, 0.3); }
        .tab-nav { display: flex; gap: 12px; border-bottom: 1px solid rgba(59, 130, 246, 0.2); overflow-x: auto; padding-bottom: 16px; margin-bottom: 32px; }
        .tab-btn { padding: 10px 20px; border: none; background: transparent; color: #94a3b8; cursor: pointer; font-weight: 500; transition: all 0.3s ease; border-bottom: 2px solid transparent; white-space: nowrap; }
        .tab-btn:hover { color: #cbd5e1; }
        .tab-btn.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        
        body.light-mode .tab-btn { color: #64748b; }
        body.light-mode .tab-btn:hover { color: #475569; }
        body.light-mode .tab-btn.active { color: #3b82f6; }
        .hash-display { background: rgba(0, 0, 0, 0.4); border-radius: 8px; padding: 12px 16px; font-family: 'Courier New', monospace; font-size: 12px; color: #10b981; word-break: break-all; border: 1px solid rgba(16, 185, 129, 0.2); }
        
        body.light-mode .hash-display { background: rgba(240, 253, 244, 1); color: #059669; border: 1px solid rgba(16, 185, 129, 0.3); }
        .stat-card { background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 24px; transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-4px); border-color: rgba(59, 130, 246, 0.4); }
        .timeline-item { display: flex; gap: 20px; margin-bottom: 24px; }
        .timeline-dot { width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; border: 2px solid rgba(59, 130, 246, 0.5); }
        .notification { position: fixed; top: 24px; right: 24px; padding: 16px 24px; border-radius: 10px; display: flex; align-items: center; gap: 12px; z-index: 1000; animation: slideRight 0.3s ease-out; }
        .notification.success { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%); border: 1px solid rgba(16, 185, 129, 0.3); color: #6ee7b7; }
        .notification.error { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%); border: 1px solid rgba(239, 68, 68, 0.3); color: #fca5a5; }
        .hidden { display: none; }
    </style>
</head>

<body class="min-h-screen">
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
        <span id="themeIcon">üåô</span>
    </button>
    
    <div class="max-w-7xl mx-auto px-4 py-8">
        
        <!-- Header -->
        <div class="text-center mb-12 fade-in">
            <h1 class="text-5xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                VeriCourt
            </h1>
            <p class="text-lg text-slate-300 mb-2">Digital Evidence Integrity Platform</p>
            <p class="text-slate-400">Professional-grade cryptographic verification for legal proceedings</p>
        </div>

        <!-- Main Container -->
        <div class="glass-dark rounded-2xl p-8 mb-8">

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="showTab('register', event)">üì• Register Evidence</button>
                <button class="tab-btn" onclick="showTab('verify', event)">üîç Verify Evidence</button>
                <button class="tab-btn" onclick="showTab('multi', event)">üîó Case Analysis</button>
                <button class="tab-btn" onclick="showTab('chain', event)">‚è±Ô∏è Audit Trail</button>
                <button class="tab-btn" onclick="showTab('dashboard', event)">üìä Dashboard</button>
            </div>

            <!-- Register Tab -->
            <div id="tab-register" class="tab-content">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-6">Register Evidence</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Evidence ID *</label>
                                <input id="evidenceId" type="text" class="input-field w-full" placeholder="CASE2025_VID_001">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Case Number</label>
                                <input id="caseNumber" type="text" class="input-field w-full" placeholder="CR-2025-1234">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Officer Name *</label>
                                <input id="uploaderName" type="text" class="input-field w-full" placeholder="Officer John Doe">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Source Type *</label>
                                <select id="sourceType" class="input-field w-full">
                                    <option value="CCTV">üé• Official CCTV System</option>
                                    <option value="DASHCAM">üöó Vehicle Dashcam</option>
                                    <option value="MOBILE">üì± Mobile Device</option>
                                    <option value="FORWARDED">üì§ Third-party Source</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold mb-6">Upload File</h2>
                        <input type="file" id="registerFile" class="hidden" onchange="handleFileSelect(this, 'registerFileName')">
                        <div id="registerDropZone" class="drop-zone mb-6">
                            <svg class="w-16 h-16 mx-auto mb-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="font-semibold mb-2">Drop evidence file or click</p>
                            <p class="text-sm text-slate-400 mb-2" id="registerFileName">No file selected</p>
                            <p class="text-xs text-slate-500">Video, Images, Documents ‚Ä¢ Max 100MB</p>
                        </div>
                        <button onclick="registerEvidence()" class="btn-primary w-full">Register & Verify</button>
                    </div>
                </div>

                <div id="registerResult" class="hidden mt-8 glass-dark border border-green-500/30 rounded-2xl p-8">
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center gap-3">
                            <div class="text-4xl">‚úÖ</div>
                            <div>
                                <h3 class="text-2xl font-bold">Registration Successful</h3>
                                <p class="text-slate-400">Evidence secured with cryptographic verification</p>
                            </div>
                        </div>
                        <button onclick="downloadEvidencePDF('register')" class="btn-primary flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Download PDF
                        </button>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="glass-dark rounded-xl p-4 border border-blue-500/20">
                            <p class="text-sm text-slate-400 mb-1">Evidence ID</p>
                            <p class="text-lg font-bold" id="resEvidenceId"></p>
                        </div>
                        <div class="glass-dark rounded-xl p-4 border border-blue-500/20">
                            <p class="text-sm text-slate-400 mb-1">Risk Assessment</p>
                            <p class="text-lg font-bold" id="resRisk"></p>
                        </div>
                    </div>

                    <div class="glass-dark rounded-xl p-4 border border-blue-500/20 mb-4">
                        <p class="text-sm text-slate-400 mb-2">SHA-256 Checksum</p>
                        <div class="hash-display" id="resHash"></div>
                    </div>

                    <div id="detectionResult" class="glass-dark rounded-xl p-4 border border-blue-500/20">
                        <p class="text-sm text-slate-400 mb-2">Authenticity Check</p>
                        <div id="detectionContent"></div>
                    </div>
                </div>
            </div>

            <!-- Verify Tab -->
            <div id="tab-verify" class="tab-content hidden">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-6">Verify Integrity</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Evidence ID *</label>
                                <input id="verifyEvidenceId" type="text" class="input-field w-full" placeholder="Enter Evidence ID">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Verifier Name</label>
                                <input id="verifierName" type="text" class="input-field w-full" placeholder="Your Name">
                            </div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold mb-6">Upload File</h2>
                        <input type="file" id="verifyFile" class="hidden" onchange="handleFileSelect(this, 'verifyFileName')">
                        <div id="verifyDropZone" class="drop-zone mb-6">
                            <svg class="w-16 h-16 mx-auto mb-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <p class="font-semibold mb-2">Drop file to verify</p>
                            <p class="text-sm text-slate-400" id="verifyFileName">No file selected</p>
                        </div>
                        <button onclick="verifyEvidence()" class="btn-primary w-full">Verify Integrity</button>
                    </div>
                </div>

                <div id="verifyResult" class="hidden mt-8 rounded-2xl p-8" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border: 1px solid rgba(16, 185, 129, 0.3);">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div id="verifyIcon" class="text-4xl"></div>
                            <div>
                                <h3 class="text-2xl font-bold" id="verifyTitle"></h3>
                                <p class="text-slate-400" id="verifyTimestamp"></p>
                            </div>
                        </div>
                        <button onclick="downloadEvidencePDF('verify')" class="btn-primary flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Download PDF
                        </button>
                    </div>
                    <div id="verifyContent" class="glass-dark rounded-xl p-4 border border-green-500/20"></div>
                </div>
            </div>

            <!-- Case Analysis Tab -->
            <div id="tab-multi" class="tab-content hidden">
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-6">Create Case</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Case ID *</label>
                                <input id="multiCaseId" type="text" class="input-field w-full" placeholder="CASE-2025-001">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Case Name</label>
                                <input id="multiCaseName" type="text" class="input-field w-full" placeholder="Investigation Name">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Lead Investigator</label>
                                <input id="multiInvestigator" type="text" class="input-field w-full" placeholder="Detective Name">
                            </div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold mb-6">Link Evidence</h2>
                        <label class="block text-sm font-medium mb-2">Evidence IDs (comma-separated) *</label>
                        <textarea id="multiEvidenceIds" class="input-field w-full mb-4" rows="5" placeholder="CASE2025_VID_001, CASE2025_VID_002"></textarea>
                        <button onclick="createMultiEvidenceCase()" class="btn-primary w-full">Analyze Case</button>
                    </div>
                </div>

                <div id="multiResult" class="hidden glass-dark border border-blue-500/20 rounded-2xl p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold">üìä Corroboration Report</h3>
                        <button onclick="downloadEvidencePDF('multi')" class="btn-primary flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Download PDF
                        </button>
                    </div>
                    <div id="multiContent"></div>
                </div>
            </div>

            <!-- Audit Trail Tab -->
            <div id="tab-chain" class="tab-content hidden">
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-6">View Audit Trail</h2>
                        <label class="block text-sm font-medium mb-2">Evidence ID *</label>
                        <input id="chainEvidenceId" type="text" class="input-field w-full mb-4" placeholder="Enter Evidence ID">
                        <button onclick="viewChainOfCustody()" class="btn-primary w-full">Load Trail</button>
                    </div>
                </div>

                <div id="chainResult" class="hidden glass-dark border border-blue-500/20 rounded-2xl p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold">‚è±Ô∏è Complete Custody Record</h3>
                        <button onclick="downloadEvidencePDF('chain')" class="btn-primary flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Download PDF
                        </button>
                    </div>
                    <div id="chainContent"></div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-8">System Overview</h2>
                
                <div class="grid md:grid-cols-4 gap-4 mb-8">
                    <div class="stat-card">
                        <p class="text-sm text-slate-400 mb-2">Total Evidence</p>
                        <p class="text-4xl font-bold" id="dashTotal">0</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-sm text-slate-400 mb-2">Active Cases</p>
                        <p class="text-4xl font-bold" id="dashCases">0</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-sm text-slate-400 mb-2">Flagged Items</p>
                        <p class="text-4xl font-bold text-orange-400" id="dashFlagged">0</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-sm text-slate-400 mb-2">Verified Safe</p>
                        <p class="text-4xl font-bold text-green-400" id="dashSafe">0</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div class="glass-dark rounded-2xl border border-blue-500/20 p-8">
                        <h3 class="text-xl font-bold mb-6">Risk Distribution</h3>
                        <div id="dashRisk" class="space-y-4"></div>
                    </div>

                    <div class="glass-dark rounded-2xl border border-blue-500/20 p-8">
                        <h3 class="text-xl font-bold mb-6">Recent Submissions</h3>
                        <div id="dashRecent" class="space-y-3"></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <div class="text-center text-slate-500 text-sm mt-8">
            <p>üîí SHA-256 Cryptographic Hash ‚Ä¢ üõ°Ô∏è Forensic Grade Authentication</p>
            <p>VeriCourt ¬© 2025 ‚Ä¢ Securing Digital Justice</p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';

        // Store current data for PDF generation
        let currentData = {
            register: null,
            verify: null,
            multi: null,
            chain: null
        };

        // Theme Toggle Function
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            } else {
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('themeIcon');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeIcon.textContent = '‚òÄÔ∏è';
            }
        });

        function showTab(tabName, event) {
            event.preventDefault();
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            if (tabName === 'dashboard') loadDashboard();
        }

        function handleFileSelect(input, displayId) {
            if (input.files[0]) {
                const file = input.files[0];
                const size = (file.size / 1024 / 1024).toFixed(2);
                document.getElementById(displayId).textContent = `${file.name} (${size} MB)`;
            }
        }

        function showNotification(message, type) {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.innerHTML = `<span>${type === 'success' ? '‚úì' : '‚ö†'}</span><span>${message}</span>`;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 4000);
        }

        async function registerEvidence() {
            const file = document.getElementById('registerFile').files[0];
            const evidenceId = document.getElementById('evidenceId').value.trim();
            const uploaderName = document.getElementById('uploaderName').value.trim();
            const sourceType = document.getElementById('sourceType').value;
            const caseNumber = document.getElementById('caseNumber').value.trim();

            if (!file || !evidenceId || !uploaderName) {
                showNotification('Please complete all required fields', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('evidence_id', evidenceId);
            formData.append('uploader_name', uploaderName);
            formData.append('source_type', sourceType);
            formData.append('case_number', caseNumber);

            try {
                const res = await fetch(`${API_BASE}/register`, { method: 'POST', body: formData });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                // Store data for PDF
                currentData.register = {
                    ...data,
                    uploader_name: uploaderName,
                    case_number: caseNumber,
                    source_type: sourceType,
                    file_name: file.name,
                    file_size: (file.size / 1024 / 1024).toFixed(2)
                };

                document.getElementById('resEvidenceId').textContent = data.evidence_id;
                document.getElementById('resHash').textContent = data.hash;
                document.getElementById('resRisk').textContent = data.pre_entry_risk;

                const detection = data.ai_detection;
                const detectionDiv = document.getElementById('detectionContent');
                if (detection.is_manipulated) {
                    detectionDiv.innerHTML = `<span class="badge badge-warning">‚ö†Ô∏è Authentication concern</span><p class="text-sm mt-2">Type: ${detection.manipulation_type}</p>`;
                } else {
                    detectionDiv.innerHTML = `<span class="badge badge-success">‚úÖ Verified authentic</span><p class="text-sm mt-2">No concerns detected</p>`;
                }
                document.getElementById('registerResult').classList.remove('hidden');
                showNotification('Evidence registered successfully', 'success');
            } catch (err) {
                showNotification(err.message, 'error');
            }
        }

        async function verifyEvidence() {
            const file = document.getElementById('verifyFile').files[0];
            const evidenceId = document.getElementById('verifyEvidenceId').value.trim();
            const verifierName = document.getElementById('verifierName').value.trim() || 'Anonymous';

            if (!file || !evidenceId) {
                showNotification('Please provide evidence ID and file', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('evidence_id', evidenceId);
            formData.append('verifier_name', verifierName);

            try {
                const res = await fetch(`${API_BASE}/verify`, { method: 'POST', body: formData });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                // Store data for PDF
                currentData.verify = {
                    ...data,
                    evidence_id: evidenceId,
                    verifier_name: verifierName,
                    file_name: file.name,
                    file_size: (file.size / 1024 / 1024).toFixed(2)
                };

                const resultDiv = document.getElementById('verifyResult');
                const icon = document.getElementById('verifyIcon');
                const content = document.getElementById('verifyContent');
                const title = document.getElementById('verifyTitle');
                const timestamp = document.getElementById('verifyTimestamp');

                timestamp.textContent = `Verified at ${new Date(data.verification_timestamp).toLocaleString()}`;

                if (data.integrity_status === 'INTACT') {
                    title.textContent = '‚úÖ Integrity Verified';
                    icon.textContent = '‚úÖ';
                    content.innerHTML = '<p class="text-green-400 font-semibold">No tampering detected</p>';
                    showNotification('Evidence is intact', 'success');
                } else {
                    title.textContent = 'üö® Integrity Compromised';
                    icon.textContent = 'üö®';
                    content.innerHTML = '<p class="text-red-400 font-semibold">Evidence has been modified</p>';
                    showNotification('Evidence tampering detected', 'error');
                }
                resultDiv.classList.remove('hidden');
            } catch (err) {
                showNotification(err.message, 'error');
            }
        }

        async function createMultiEvidenceCase() {
            const caseId = document.getElementById('multiCaseId').value.trim();
            const caseName = document.getElementById('multiCaseName').value.trim();
            const investigator = document.getElementById('multiInvestigator').value.trim();
            const evidenceIdsStr = document.getElementById('multiEvidenceIds').value.trim();

            if (!caseId || !evidenceIdsStr) {
                showNotification('Please provide case ID and evidence IDs', 'error');
                return;
            }

            const evidenceIds = evidenceIdsStr.split(',').map(id => id.trim());

            try {
                const res = await fetch(`${API_BASE}/multi-evidence/create-case`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ case_id: caseId, case_name: caseName, investigator, evidence_ids: evidenceIds })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                const analyzeRes = await fetch(`${API_BASE}/multi-evidence/corroborate/${caseId}`);
                const analyzeData = await analyzeRes.json();

                // Store data for PDF
                currentData.multi = {
                    case_id: caseId,
                    case_name: caseName,
                    investigator: investigator,
                    ...analyzeData
                };

                const content = document.getElementById('multiContent');
                content.innerHTML = `
                    <div class="glass-dark rounded-xl p-5 border border-blue-500/20 mb-4">
                        <h4 class="font-bold mb-3">Case Summary</h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div><p class="text-sm text-slate-400">Case ID</p><p class="font-semibold">${caseId}</p></div>
                            <div><p class="text-sm text-slate-400">Total Evidence</p><p class="font-semibold">${analyzeData.total_evidence}</p></div>
                            <div><p class="text-sm text-slate-400">Score</p><p class="font-semibold text-blue-400">${analyzeData.corroboration_score}%</p></div>
                        </div>
                    </div>
                    <div class="glass-dark rounded-xl p-5 border border-blue-500/20">
                        <h4 class="font-bold mb-3">Evidence Details</h4>
                        ${analyzeData.evidence_details.map(ev => `<div class="border-l-4 border-blue-400 pl-4 py-2"><p class="font-semibold text-sm">${ev.evidence_id}</p><p class="text-xs text-slate-400">${ev.source_type} | ${ev.risk}</p></div>`).join('')}
                    </div>
                `;
                document.getElementById('multiResult').classList.remove('hidden');
                showNotification('Case analyzed successfully', 'success');
            } catch (err) {
                showNotification(err.message, 'error');
            }
        }

        async function viewChainOfCustody() {
            const evidenceId = document.getElementById('chainEvidenceId').value.trim();

            if (!evidenceId) {
                showNotification('Please enter evidence ID', 'error');
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/chain-of-custody/${evidenceId}`);
                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                // Store data for PDF
                currentData.chain = {
                    evidence_id: evidenceId,
                    ...data
                };

                const content = document.getElementById('chainContent');
                if (data.chain.length === 0) {
                    content.innerHTML = '<p class="text-slate-500 text-center py-4">No audit records found</p>';
                } else {
                    content.innerHTML = data.chain.map((entry, i) => `
                        <div class="timeline-item">
                            <div class="timeline-dot">${i + 1}</div>
                            <div class="flex-1">
                                <div class="glass-dark rounded-xl p-4 border border-blue-500/20">
                                    <div class="flex justify-between items-start mb-2">
                                        <p class="font-bold">${entry.action}</p>
                                        <span class="text-xs text-slate-400">${new Date(entry.timestamp).toLocaleString()}</span>
                                    </div>
                                    <p class="text-sm">Officer: ${entry.user}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                document.getElementById('chainResult').classList.remove('hidden');
                showNotification('Audit trail loaded', 'success');
            } catch (err) {
                showNotification(err.message, 'error');
            }
        }

        // PDF Download Function
        async function downloadEvidencePDF(type) {
            const data = currentData[type];
            if (!data) {
                showNotification('No data available to download. Please complete an action first.', 'error');
                return;
            }

            showNotification('Generating PDF...', 'success');

            try {
                let endpoint = '';
                let body = {};

                switch(type) {
                    case 'register':
                        endpoint = '/download-pdf/evidence';
                        body = { evidence_id: data.evidence_id };
                        break;
                    case 'verify':
                        endpoint = '/download-pdf/verification';
                        body = { evidence_id: data.evidence_id };
                        break;
                    case 'multi':
                        endpoint = '/download-pdf/case';
                        body = { case_id: data.case_id };
                        break;
                    case 'chain':
                        endpoint = '/download-pdf/chain';
                        body = { evidence_id: data.evidence_id };
                        break;
                }

                console.log('Requesting PDF:', `${API_BASE}${endpoint}`, body);

                const res = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                console.log('Response status:', res.status);

                if (!res.ok) {
                    let errorMsg = 'Failed to generate PDF';
                    try {
                        const error = await res.json();
                        errorMsg = error.error || errorMsg;
                    } catch (e) {
                        errorMsg = `Server error: ${res.status}`;
                    }
                    throw new Error(errorMsg);
                }

                const blob = await res.blob();
                console.log('PDF blob size:', blob.size);

                if (blob.size === 0) {
                    throw new Error('Received empty PDF file');
                }

                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                let filename = '';
                const dateStr = new Date().toISOString().split('T')[0];
                switch(type) {
                    case 'register':
                    case 'verify':
                        filename = `Evidence_${data.evidence_id}_${dateStr}.pdf`;
                        break;
                    case 'multi':
                        filename = `Case_Report_${data.case_id}_${dateStr}.pdf`;
                        break;
                    case 'chain':
                        filename = `Chain_of_Custody_${data.evidence_id}_${dateStr}.pdf`;
                        break;
                }
                
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                }, 100);
                
                showNotification('PDF downloaded successfully!', 'success');
            } catch (err) {
                console.error('PDF download error:', err);
                showNotification('PDF Download Error: ' + err.message, 'error');
            }
        }

        async function loadDashboard() {
            try {
                const statsRes = await fetch(`${API_BASE}/dashboard/stats`);
                const stats = await statsRes.json();
                const listRes = await fetch(`${API_BASE}/evidence/list`);
                const list = await listRes.json();

                document.getElementById('dashTotal').textContent = stats.total_evidence;
                document.getElementById('dashCases').textContent = stats.total_cases;
                document.getElementById('dashFlagged').textContent = stats.ai_flagged_count;
                document.getElementById('dashSafe').textContent = stats.risk_distribution.LOW || 0;

                const riskDiv = document.getElementById('dashRisk');
                const max = Math.max(...Object.values(stats.risk_distribution), 1);
                riskDiv.innerHTML = Object.entries(stats.risk_distribution).map(([level, count]) => `
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-semibold">${level}</span>
                            <span class="text-sm text-slate-400">${count}</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-2">
                            <div class="h-2 rounded-full bg-blue-500" style="width: ${(count / max) * 100}%"></div>
                        </div>
                    </div>
                `).join('');

                const recentDiv = document.getElementById('dashRecent');
                recentDiv.innerHTML = (list.evidence || []).slice(0, 5).map(ev => `
                    <div class="border-l-4 border-blue-400 pl-4 py-2">
                        <p class="font-semibold text-sm">${ev.evidence_id}</p>
                        <p class="text-xs text-slate-400">${ev.source_type} | ${ev.risk}</p>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Dashboard error:', err);
            }
        }

        // Setup drag & drop
        ['registerDropZone', 'verifyDropZone'].forEach(zoneId => {
            const zone = document.getElementById(zoneId);
            const fileId = zoneId.replace('DropZone', 'File');
            ['dragover', 'dragenter'].forEach(ev => zone.addEventListener(ev, (e) => { e.preventDefault(); zone.classList.add('drag-over'); }));
            ['dragleave', 'drop'].forEach(ev => zone.addEventListener(ev, () => zone.classList.remove('drag-over')));
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                document.getElementById(fileId).files = e.dataTransfer.files;
                handleFileSelect(document.getElementById(fileId), zoneId.replace('DropZone', 'FileName'));
            });
            zone.addEventListener('click', () => document.getElementById(fileId).click());
        });
    </script>

</body>
</html>